### 1) vbox config ###
vmconine, linux 4.x 64b, 2GB, 32GB VDI, geen floppy, default cdboot, utc tijd, geen remote display,
alpine-virt-3.8.1 64, eth:natnet1, mac 080027AE3A2A, eth1:vboxnet0, 0800273A3456

### 2) installatie
inloggen als root zonder pass en de volgende keyboard input
setup-alpine #standaard installatie
us	#toetsenbord
us-dvorak
vmconine #hostname
eth0 #netwerk config
192.168.15.2/24
192.168.15.1
eth1
192.168.56.2/24
none
no ##manueele config
garofil.be ##dns
8.8.8.8
#wachtwoord, standaard thuispass
Europe	#tijdzone
Brussels
none	#proxy
2	#mirror
none	#sshserver
none	#ntpserver
sda	#schijf
sys	#schijfgebruik
y
halt #setup is klaar, afsluiten

### 3) docker installatie
vi /etc/apk/repositories
#de community lijn uncommenten
apk update
apk add docker && rc-update add docker boot
halt

### 4) tijdelijk ssh server
docker run -v /root:/root -d -p 22:22 --name temp-sshd rastasheep/ubuntu-sshd && docker exec -ti temp-sshd passwd
docker stop temp-sshd
halt

### 5) onnodige services niet meer opstarten
in /etc/inittab de lijnen beginnend met tty[2-6] commenten en de lijnen met ttyS0 commenten (bij de laatst is dit nog niet gebeurd) #zet alle terminals uit behalve de 1ste
docker start temp-sshd
vanop ander systeem: scp daemonsuit.sh root@192.168.56.2:/root
/root/daemonsuit.sh && rm /root/daemonsuit.sh #acpid, crond, syslog en klogd niet meer laten opstarten (errors zijn er want niet alles is overal)
docker stop temp-sshd
halt

### 6) een compileerimage maken
docker start temp-sshd
vanop ander systeem: scp DockerfileCOMPILEER root@192.168.56.2:/root/Dockerfile
docker build -t compileerimg . && rm Dockerfile
docker stop temp-sshd
halt

### 7) met onbestaande user 'geendocker' een niet-container shell maken
docker start temp-sshd
vanop ander systeem: scp geendocker.c maak_bin_login.sh root@192.168.56.2:/root/
/root/maak_bin_login.sh && rm /root/maak_bin_login.sh
docker stop temp-sshd
halt
#DEBUG
docker run -ti --name compileer compileerimg
een main.c maken met 1 van de volgende inhouden
//BEGIN met docker
#include <stdlib.h> //EXIT_FAILURE
#include <unistd.h> //execl

int main(int argc, char** argv) {
	execl("/usr/bin/docker", "/usr/bin/docker", "run", "--rm", "-ti", "--name", "conthoofd", "-v", "/var/run/docker.sock:/var/run/docker.sock", "ubuntu", (char*) NULL);
	return EXIT_FAILURE;
}

//BEGIN met ash
#include <stdlib.h> //EXIT_FAILURE
#include <stdio.h>  //printf
#include <unistd.h> //execl

int main(int argc, char** argv) {
	for(int i=0; i < argc; i++) {
		printf("|%s|\n", argv[i]);
	}
	execl("/bin/ash", "/bin/ash", (char*) NULL);
	return EXIT_FAILURE;
}

//BEGIN met enkel ash
#include <stdlib.h> //EXIT_FAILURE
#include <unistd.h> //execl

int main(int argc, char** argv) {
	execl("/bin/ash", "/bin/ash", (char*) NULL);
	return EXIT_FAILURE;
}

//BEGIN correct
#include <stdlib.h>	//EXIT_FAILURE
#include <stdio.h>	//sprintf
#include <string.h>	//strcmp
#include <unistd.h>	//execl

#define	GEENDOCKER	"geendocker"
#define GEENDOCKERSHELL	"/bin/ash"
#define TEWEINIGARGS	"FOUT: Te weinig argument meegekregen:\n"
#define ARGINHOUD	"argv[%d] = |%s|\n"	//%d is argnr, %s is arginhoud

int main(int argc, char** argv) {
	if(argc
	for(int i=0; i < argc; i++) {
		printf("|%s|\n", argv[i]);
	}
	execl("/bin/ash", "/bin/ash", (char*) NULL);
	return EXIT_FAILURE;
}

//EINDE

apk add gcc musl-dev && gcc main.c -Wall -Werror -Os -o /bin/login
# nu wordt opgestart:
#1 /sbin/init
#	/usr/bin/dockerd -p /run/docker.pid
#		docker-containerd --config /var/run/docker/containerd/containerd.toml
#	/bin/ash

